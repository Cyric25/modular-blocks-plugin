!function(){"use strict";console.log("ðŸ”§ IMAGE OVERLAY DEBUG - view.js v2.4.0 loaded at " + new Date().toISOString());console.log("ðŸŽ¨ Using theme colors (var(--primary-color)), NO layer-color variable!");function e(e){if(!e)return;if("true"===e.dataset.initialized)return void console.log("Image Overlay already initialized, skipping");e.dataset.initialized="true";const t=JSON.parse(e.dataset.overlay||"{}"),o=e.querySelector(".image-overlay-container"),l=e.querySelectorAll(".layer-button"),n=e.querySelectorAll(".overlay-layer"),i=e.querySelector(".show-all"),a=e.querySelector(".hide-all"),r=e.querySelector(".layer-info"),s=e.querySelector(".info-title"),c=e.querySelector(".info-description");if(!o||0===l.length||0===n.length)return void console.warn("Image Overlay: Missing required elements",{container:!!o,buttons:l.length,layers:n.length});const d=t.layers||[],u=t.displayMode||"overlay",y=(t.transitionDuration,t.strings||{});function g(e){const t=l[e],o=n[e],i=d[e];if(!t||!o||!i)return void console.warn("Show layer: Invalid index",e);console.log("Showing layer",e,i.label),t.classList.add("active"),t.setAttribute("aria-pressed","true"),t.title=(y.hideLayer||"Ausblenden")+": "+i.label,o.classList.remove("hidden"),o.classList.add("visible");const a=(i.opacity||100)/100;o.style.opacity=a,t.style.transform="translateY(-2px)",setTimeout(()=>{t.style.transform=""},150)}function f(e){const t=l[e],o=n[e],i=d[e];t&&o&&i?(console.log("Hiding layer",e,i.label),t.classList.remove("active"),t.setAttribute("aria-pressed","false"),t.title=(y.showLayer||"Anzeigen")+": "+i.label,o.classList.remove("visible"),o.classList.add("hidden"),o.style.opacity="0"):console.warn("Hide layer: Invalid index",e)}function v(e){if(e<0||e>=d.length)return void console.warn("Toggle layer: Index out of bounds",e);const t=l[e].classList.contains("active");if(console.log("Toggling layer",e,"currently visible:",t,"mode:",u),"toggle"===u){if(t)return void console.log("Layer already active, ignoring click");l.forEach((e,t)=>f(t)),g(e),b(e)}else t?(f(e),b(-1)):(g(e),b(e))}function b(e){if(r)if(e>=0&&e<d.length){const t=d[e];s&&(s.textContent=t.label||""),c&&(c.textContent=t.description||""),r.style.display="block",r.classList.add("active")}else r.style.display="none",r.classList.remove("active")}function h(e){const t=document.activeElement,o=Array.from(l).indexOf(t);if(-1===o)return;let n=o;switch(e.key){case"ArrowLeft":case"ArrowUp":n=o>0?o-1:l.length-1;break;case"ArrowRight":case"ArrowDown":n=o<l.length-1?o+1:0;break;case"Home":n=0;break;case"End":n=l.length-1;break;case"Enter":case" ":return e.preventDefault(),void v(o);default:return}e.preventDefault(),l[n]&&l[n].focus()}console.log("Image Overlay initialized",{blockId:e.id,displayMode:u,layerCount:d.length,buttonCount:l.length}),l.forEach((e,t)=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),console.log("Button clicked:",t),v(t)}),e.addEventListener("keydown",h),e.setAttribute("tabindex","0"),e.setAttribute("role","switch")}),i&&i.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),console.log("Showing all layers"),l.forEach((e,t)=>g(t))}),a&&a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),console.log("Hiding all layers"),l.forEach((e,t)=>f(t)),b(-1)}),function(){console.log("Initializing layer states"),d.forEach((e,t)=>{e.visible?g(t):f(t)});const e=Array.from(l).findIndex(e=>e.classList.contains("active"));e>=0&&b(e)}()}function t(){const t=document.querySelectorAll(".wp-block-modular-blocks-image-overlay");console.log("Found image overlay blocks:",t.length),t.forEach(e)}window.initImageOverlay=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),window.addEventListener("load",t),window.MutationObserver&&new MutationObserver(function(t){t.forEach(function(t){"childList"===t.type&&t.addedNodes.forEach(function(t){if(t.nodeType===Node.ELEMENT_NODE){t.classList&&t.classList.contains("wp-block-modular-blocks-image-overlay")&&e(t);const o=t.querySelectorAll&&t.querySelectorAll(".wp-block-modular-blocks-image-overlay");o&&o.forEach(e)}})})}).observe(document.body,{childList:!0,subtree:!0})}();