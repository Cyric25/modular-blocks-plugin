!function(){"use strict";window.initSummaryBlock=function(e){if(!e)return;const t=e.getAttribute("data-summary-config");if(!t)return;const n=JSON.parse(t),s=(e.querySelector(".statements-pool"),e.querySelector(".summary-order-section")),r=e.querySelector(".selected-statements"),o=e.querySelector(".summary-check"),c=e.querySelector(".summary-retry"),i=e.querySelector(".summary-solution"),a=e.querySelector(".summary-results"),l=e.querySelector(".result-message"),d=e.querySelector(".score-display"),u=e.querySelector(".feedback-container");let m=[],y=!1;const f=e.querySelectorAll(".statement-item");function p(){m.length>0?(s.style.display="block",r.innerHTML="",m.forEach((t,s)=>{const o=e.querySelector(`[data-statement-index="${t}"]`),c=document.createElement("div");c.className="selected-statement",c.setAttribute("data-statement-index",t),c.setAttribute("data-position",s+1),c.innerHTML=`\n\t\t\t\t\t\t<span class="position-number">${s+1}</span>\n\t\t\t\t\t\t<span class="statement-text">${o.textContent}</span>\n\t\t\t\t\t\t<button type="button" class="remove-statement">&times;</button>\n\t\t\t\t\t`,c.querySelector(".remove-statement").addEventListener("click",e=>{e.stopPropagation();const n=m.indexOf(t);n>-1&&(m.splice(n,1),o.classList.remove("selected"),p())}),n.allowReordering&&(c.setAttribute("draggable","true"),c.addEventListener("dragstart",S),c.addEventListener("dragover",L),c.addEventListener("drop",q),c.addEventListener("dragend",v)),r.appendChild(c)})):s.style.display="none"}f.forEach(e=>{e.addEventListener("click",()=>function(e){if(y)return;const t=parseInt(e.getAttribute("data-statement-index")),s=m.indexOf(t);s>-1?(m.splice(s,1),e.classList.remove("selected")):m.length<n.requiredSelections&&(m.push(t),e.classList.add("selected")),p()}(e))}),o&&o.addEventListener("click",function(){if(m.length!==n.requiredSelections)return void alert(`Bitte wählen Sie genau ${n.requiredSelections} Aussagen aus.`);y=!0;let e=0,t=0,s=n.requiredSelections*n.scoreForSelection,p=n.requiredSelections*n.scoreForOrder,g="";m.forEach((s,o)=>{const c=n.statements[s],i=o+1;c.isCorrect&&(e+=n.scoreForSelection),c.correctPosition===i&&(t+=n.scoreForOrder);const a=r.querySelector(`[data-statement-index="${s}"][data-position="${i}"]`);if(a){const e=c.isCorrect,t=c.correctPosition===i;e&&t?a.classList.add("correct"):a.classList.add("incorrect"),n.showFeedback&&c.feedback&&(g+=`<div class="statement-feedback ${e&&t?"correct":"incorrect"}">\n\t\t\t\t\t\t\t<strong>${i}.</strong> ${c.feedback}\n\t\t\t\t\t\t</div>`)}});const S=e+t,v=s+p;(function(e,t,s,r){if(!a)return;a.style.display="block";let o="";o=s>=n.passPercentage?n.successText:s>=50?n.partialSuccessText:n.failText,l&&(l.textContent=o,l.className="result-message "+(s>=n.passPercentage?"success":"fail")),d&&(d.textContent=`${e} von ${t} Punkten (${Math.round(s)}%)`),u&&r&&(u.innerHTML=r)})(S,v,v>0?S/v*100:0,g),f.forEach(e=>{e.style.pointerEvents="none"}),r.querySelectorAll(".remove-statement").forEach(e=>e.style.display="none"),o.style.display="none",c&&(c.style.display="inline-block"),i&&(i.style.display="inline-block")}),c&&c.addEventListener("click",function(){y=!1,m=[],f.forEach(e=>{e.classList.remove("selected"),e.style.pointerEvents=""}),r.innerHTML="",s.style.display="none",a&&(a.style.display="none"),u&&(u.innerHTML=""),o.style.display="inline-block",c&&(c.style.display="none"),i&&(i.style.display="none")}),i&&i.addEventListener("click",function(){if(m=[],f.forEach(e=>e.classList.remove("selected")),n.statements.map((e,t)=>({...e,originalIndex:t})).filter(e=>e.isCorrect).sort((e,t)=>e.correctPosition-t.correctPosition).forEach(t=>{m.push(t.originalIndex);const n=e.querySelector(`[data-statement-index="${t.originalIndex}"]`);n&&n.classList.add("selected")}),p(),r.querySelectorAll(".selected-statement").forEach(e=>{e.classList.add("correct","solution")}),a&&(a.style.display="block",l&&(l.textContent="Lösung wird angezeigt.",l.className="result-message solution"),d)){const e=n.requiredSelections*n.scoreForSelection+n.requiredSelections*n.scoreForOrder;d.textContent=`${e} von ${e} Punkten (100%)`}u&&(u.innerHTML=""),i&&(i.style.display="none")});let g=null;function S(e){y||(g=e.target,e.target.classList.add("dragging"))}function v(e){e.target.classList.remove("dragging")}function L(e){e.preventDefault();const t=(n=r,s=e.clientY,[...n.querySelectorAll(".selected-statement:not(.dragging)")].reduce((e,t)=>{const n=t.getBoundingClientRect(),r=s-n.top-n.height/2;return r<0&&r>e.offset?{offset:r,element:t}:e},{offset:Number.NEGATIVE_INFINITY}).element);var n,s;null==t?r.appendChild(g):r.insertBefore(g,t)}function q(e){e.preventDefault(),m=[],r.querySelectorAll(".selected-statement").forEach(e=>{const t=parseInt(e.getAttribute("data-statement-index"));m.push(t)}),p()}},document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".wp-block-modular-blocks-summary-block").forEach(e=>{window.initSummaryBlock(e)})})}();